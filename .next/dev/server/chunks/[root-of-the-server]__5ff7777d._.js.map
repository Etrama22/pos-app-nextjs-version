{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/azis.muhammad/Documents/Me/pos-app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined\r\n}\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n\r\nexport default prisma\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/azis.muhammad/Documents/Me/pos-app/src/app/api/sales/export/pdf/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { format } from \"date-fns\";\r\nimport { id } from \"date-fns/locale\";\r\n\r\n// Simple PDF generator without external dependencies\r\nfunction generatePDF(sales: any[], summary: any, dateRange: string): Buffer {\r\n  const formatCurrency = (num: number) =>\r\n    new Intl.NumberFormat(\"id-ID\", {\r\n      style: \"currency\",\r\n      currency: \"IDR\",\r\n      minimumFractionDigits: 0,\r\n    }).format(num);\r\n\r\n  const paymentMethodLabels: Record<string, string> = {\r\n    CASH: \"Tunai\",\r\n    DEBIT: \"Debit\",\r\n    CREDIT: \"Kredit\",\r\n    QRIS: \"QRIS\",\r\n    TRANSFER: \"Transfer\",\r\n  };\r\n\r\n  // Build PDF content using a simple text-based format\r\n  // This creates a basic PDF structure\r\n  let content = \"\";\r\n\r\n  content += \"========================================\\n\";\r\n  content += \"         LAPORAN PENJUALAN POS\\n\";\r\n  content += \"========================================\\n\\n\";\r\n  content += `Periode: ${dateRange}\\n`;\r\n  content += `Dicetak: ${format(new Date(), \"dd MMMM yyyy HH:mm\", {\r\n    locale: id,\r\n  })}\\n\\n`;\r\n\r\n  content += \"----------------------------------------\\n\";\r\n  content += \"              RINGKASAN\\n\";\r\n  content += \"----------------------------------------\\n\";\r\n  content += `Total Transaksi    : ${summary.totalSales}\\n`;\r\n  content += `Total Pendapatan   : ${formatCurrency(summary.totalRevenue)}\\n`;\r\n  content += `Rata-rata Transaksi: ${formatCurrency(\r\n    summary.averageTransaction\r\n  )}\\n\\n`;\r\n\r\n  content += \"----------------------------------------\\n\";\r\n  content += \"           DETAIL TRANSAKSI\\n\";\r\n  content += \"----------------------------------------\\n\\n\";\r\n\r\n  sales.forEach((sale, idx) => {\r\n    content += `[${idx + 1}] ${sale.receiptNumber}\\n`;\r\n    content += `    Tanggal : ${format(\r\n      new Date(sale.createdAt),\r\n      \"dd/MM/yyyy HH:mm\",\r\n      { locale: id }\r\n    )}\\n`;\r\n    content += `    Kasir   : ${sale.cashier?.name || \"-\"}\\n`;\r\n    content += `    Items   :\\n`;\r\n\r\n    sale.items.forEach((item: any) => {\r\n      const subtotal = item.quantity * item.priceAtSale;\r\n      content += `      - ${item.product.name}\\n`;\r\n      content += `        ${item.quantity} x ${formatCurrency(\r\n        item.priceAtSale\r\n      )} = ${formatCurrency(subtotal)}\\n`;\r\n    });\r\n\r\n    content += `    Pembayaran: ${paymentMethodLabels[sale.paymentMethod]}\\n`;\r\n    content += `    Total     : ${formatCurrency(sale.total)}\\n`;\r\n    content += \"\\n\";\r\n  });\r\n\r\n  content += \"========================================\\n\";\r\n  content += \"              END OF REPORT\\n\";\r\n  content += \"========================================\\n\";\r\n\r\n  // Create a simple PDF\r\n  const pdfContent = createSimplePDF(content);\r\n  return Buffer.from(pdfContent);\r\n}\r\n\r\nfunction createSimplePDF(text: string): string {\r\n  const lines = text.split(\"\\n\");\r\n  const pageHeight = 842; // A4 height in points\r\n  const pageWidth = 595; // A4 width in points\r\n  const margin = 50;\r\n  const lineHeight = 12;\r\n  const fontSize = 10;\r\n\r\n  let y = pageHeight - margin;\r\n  let pageContent = \"\";\r\n\r\n  lines.forEach((line) => {\r\n    if (y < margin) {\r\n      y = pageHeight - margin;\r\n    }\r\n\r\n    // Escape special PDF characters\r\n    const escapedLine = line\r\n      .replace(/\\\\/g, \"\\\\\\\\\")\r\n      .replace(/\\(/g, \"\\\\(\")\r\n      .replace(/\\)/g, \"\\\\)\");\r\n\r\n    pageContent += `BT /F1 ${fontSize} Tf ${margin} ${y} Td (${escapedLine}) Tj ET\\n`;\r\n    y -= lineHeight;\r\n  });\r\n\r\n  const pdf = `%PDF-1.4\r\n1 0 obj\r\n<< /Type /Catalog /Pages 2 0 R >>\r\nendobj\r\n\r\n2 0 obj\r\n<< /Type /Pages /Kids [3 0 R] /Count 1 >>\r\nendobj\r\n\r\n3 0 obj\r\n<< /Type /Page /Parent 2 0 R /MediaBox [0 0 ${pageWidth} ${pageHeight}] /Contents 4 0 R /Resources << /Font << /F1 5 0 R >> >> >>\r\nendobj\r\n\r\n4 0 obj\r\n<< /Length ${pageContent.length} >>\r\nstream\r\n${pageContent}\r\nendstream\r\nendobj\r\n\r\n5 0 obj\r\n<< /Type /Font /Subtype /Type1 /BaseFont /Courier >>\r\nendobj\r\n\r\nxref\r\n0 6\r\n0000000000 65535 f \r\n0000000009 00000 n \r\n0000000058 00000 n \r\n0000000115 00000 n \r\n0000000266 00000 n \r\n0000000${(366 + pageContent.length).toString().padStart(3, \"0\")} 00000 n \r\n\r\ntrailer\r\n<< /Size 6 /Root 1 0 R >>\r\nstartxref\r\n${420 + pageContent.length}\r\n%%EOF`;\r\n\r\n  return pdf;\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const startDate = searchParams.get(\"startDate\");\r\n    const endDate = searchParams.get(\"endDate\");\r\n\r\n    const where: any = {};\r\n\r\n    if (startDate || endDate) {\r\n      where.createdAt = {};\r\n      if (startDate) {\r\n        where.createdAt.gte = new Date(startDate);\r\n      }\r\n      if (endDate) {\r\n        where.createdAt.lte = new Date(endDate + \"T23:59:59\");\r\n      }\r\n    }\r\n\r\n    const sales = await prisma.sale.findMany({\r\n      where,\r\n      include: {\r\n        items: {\r\n          include: {\r\n            product: true,\r\n          },\r\n        },\r\n        cashier: {\r\n          select: {\r\n            name: true,\r\n          },\r\n        },\r\n      },\r\n      orderBy: {\r\n        createdAt: \"desc\",\r\n      },\r\n    });\r\n\r\n    // Calculate summary\r\n    const totalSales = sales.length;\r\n    const totalRevenue = sales.reduce((sum, sale) => sum + sale.total, 0);\r\n    const averageTransaction = totalSales > 0 ? totalRevenue / totalSales : 0;\r\n\r\n    const summary = {\r\n      totalSales,\r\n      totalRevenue,\r\n      averageTransaction,\r\n    };\r\n\r\n    // Date range string\r\n    let dateRange = \"Semua waktu\";\r\n    if (startDate && endDate) {\r\n      dateRange = `${format(new Date(startDate), \"dd MMM yyyy\", {\r\n        locale: id,\r\n      })} - ${format(new Date(endDate), \"dd MMM yyyy\", { locale: id })}`;\r\n    } else if (startDate) {\r\n      dateRange = `Dari ${format(new Date(startDate), \"dd MMM yyyy\", {\r\n        locale: id,\r\n      })}`;\r\n    } else if (endDate) {\r\n      dateRange = `Sampai ${format(new Date(endDate), \"dd MMM yyyy\", {\r\n        locale: id,\r\n      })}`;\r\n    }\r\n\r\n    const pdfBuffer = generatePDF(sales, summary, dateRange);\r\n    const filename = `laporan-penjualan-${format(\r\n      new Date(),\r\n      \"yyyy-MM-dd\"\r\n    )}.pdf`;\r\n\r\n    // Convert Buffer to Uint8Array for NextResponse\r\n    const pdfUint8Array = new Uint8Array(pdfBuffer);\r\n\r\n    return new NextResponse(pdfUint8Array, {\r\n      headers: {\r\n        \"Content-Type\": \"application/pdf\",\r\n        \"Content-Disposition\": `attachment; filename=\"${filename}\"`,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error exporting PDF:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to export PDF\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}