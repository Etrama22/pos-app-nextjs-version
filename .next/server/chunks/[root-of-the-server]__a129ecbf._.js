module.exports=[93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,a)=>{t.exports=e.x("util",()=>require("util"))},2986,e=>{"use strict";var t=e.i(98043);let a=new class{async findAll(e){let{page:a=1,limit:r=10,search:n,category:i,isActive:s,sortBy:o="createdAt",sortOrder:l="desc"}=e,d={...n&&{OR:[{name:{contains:n}},{description:{contains:n}},{barcode:{contains:n}}]},...i&&{category:i},...void 0!==s&&{isActive:s}},[u,c]=await Promise.all([t.default.product.findMany({where:d,skip:(a-1)*r,take:r,orderBy:{[o]:l}}),t.default.product.count({where:d})]);return{data:u,pagination:{page:a,limit:r,total:c,totalPages:Math.ceil(c/r)}}}async findById(e){return t.default.product.findUnique({where:{id:e}})}async findByBarcode(e){return t.default.product.findUnique({where:{barcode:e}})}async findActiveProducts(e){return t.default.product.findMany({where:{isActive:!0,stock:{gt:0},...e&&{OR:[{name:{contains:e}},{barcode:{contains:e}}]}},orderBy:{name:"asc"}})}async create(e){return t.default.product.create({data:{name:e.name,description:e.description,price:e.price,stock:e.stock,imageUrl:e.imageUrl,category:e.category,barcode:e.barcode,isActive:e.isActive??!0}})}async update(e,a){return t.default.product.update({where:{id:e},data:a})}async updateStock(e,a){return t.default.product.update({where:{id:e},data:{stock:{decrement:a}}})}async delete(e){return t.default.product.delete({where:{id:e}})}async getCategories(){return(await t.default.product.findMany({select:{category:!0},distinct:["category"],where:{category:{not:null}}})).map(e=>e.category).filter(Boolean)}async getLowStockProducts(e=10){return t.default.product.findMany({where:{isActive:!0,stock:{lte:e}},orderBy:{stock:"asc"}})}};e.s(["productRepository",0,a])},95717,38447,e=>{"use strict";var t=e.i(98043),a=e.i(81183);let r=new class{async findAll(e){let{page:a=1,limit:r=10,startDate:n,endDate:i,paymentMethod:s,userId:o,sortBy:l="createdAt",sortOrder:d="desc"}=e,u={...n&&{createdAt:{gte:new Date(n)}},...i&&{createdAt:{...n&&{gte:new Date(n)},lte:new Date(i)}},...s&&{paymentMethod:s},...o&&{userId:o}},[c,p]=await Promise.all([t.default.sale.findMany({where:u,include:{items:{include:{product:{select:{id:!0,name:!0,imageUrl:!0}}}},user:{select:{id:!0,name:!0,email:!0}}},skip:(a-1)*r,take:r,orderBy:{[l]:d}}),t.default.sale.count({where:u})]);return{data:c,pagination:{page:a,limit:r,total:p,totalPages:Math.ceil(p/r)}}}async findById(e){return t.default.sale.findUnique({where:{id:e},include:{items:{include:{product:{select:{id:!0,name:!0,imageUrl:!0}}}},user:{select:{id:!0,name:!0,email:!0}}}})}async findByReceiptNumber(e){return t.default.sale.findUnique({where:{receiptNumber:e},include:{items:{include:{product:{select:{id:!0,name:!0,imageUrl:!0}}}},user:{select:{id:!0,name:!0,email:!0}}}})}async create(e){let r=e.items.reduce((e,t)=>e+t.priceAtSale*t.quantity,0),n=e.discount||0,i=e.tax||0,s=r-n+i,o=e.paymentAmount-s;return t.default.$transaction(async t=>{let l=await t.sale.create({data:{receiptNumber:(0,a.generateReceiptNumber)(),subtotal:r,discount:n,tax:i,total:s,paymentMethod:e.paymentMethod,paymentAmount:e.paymentAmount,changeAmount:o>0?o:0,notes:e.notes,userId:e.userId,items:{create:e.items.map(e=>({productId:e.productId,quantity:e.quantity,priceAtSale:e.priceAtSale,subtotal:e.priceAtSale*e.quantity}))}},include:{items:{include:{product:{select:{id:!0,name:!0,imageUrl:!0}}}},user:{select:{id:!0,name:!0,email:!0}}}});for(let a of e.items)await t.product.update({where:{id:a.productId},data:{stock:{decrement:a.quantity}}});return l})}async getSummary(e,a){let r={...e&&{createdAt:{gte:new Date(e)}},...a&&{createdAt:{...e&&{gte:new Date(e)},lte:new Date(a)}}},[n,i]=await Promise.all([t.default.sale.aggregate({where:r,_count:!0,_sum:{total:!0,discount:!0,tax:!0},_avg:{total:!0}}),t.default.sale.groupBy({by:["paymentMethod"],where:r,_count:!0,_sum:{total:!0}})]);return{totalSales:n._count,totalRevenue:n._sum.total||0,totalDiscount:n._sum.discount||0,totalTax:n._sum.tax||0,averageTransaction:n._avg.total||0,paymentMethodBreakdown:i.map(e=>({method:e.paymentMethod,count:e._count,total:e._sum.total||0}))}}async getTodaySales(){let e=new Date;return e.setHours(0,0,0,0),t.default.sale.findMany({where:{createdAt:{gte:e}},include:{items:{include:{product:{select:{id:!0,name:!0,imageUrl:!0}}}}},orderBy:{createdAt:"desc"}})}async getRecentSales(e=5){return t.default.sale.findMany({include:{items:{include:{product:{select:{id:!0,name:!0,imageUrl:!0}}}},user:{select:{id:!0,name:!0,email:!0}}},orderBy:{createdAt:"desc"},take:e})}};var n=e.i(2986);let i=new class{async getSales(e){return r.findAll(e)}async getSaleById(e){let t=await r.findById(e);if(!t)throw Error("Transaksi tidak ditemukan");return t}async getSaleByReceiptNumber(e){let t=await r.findByReceiptNumber(e);if(!t)throw Error("Transaksi tidak ditemukan");return t}async createSale(e){for(let t of e.items){let e=await n.productRepository.findById(t.productId);if(!e)throw Error(`Produk dengan ID ${t.productId} tidak ditemukan`);if(!e.isActive)throw Error(`Produk ${e.name} tidak aktif`);if(e.stock<t.quantity)throw Error(`Stok ${e.name} tidak mencukupi`)}let t=e.items.reduce((e,t)=>e+t.priceAtSale*t.quantity,0),a=e.discount||0,i=e.tax||0;if(e.paymentAmount<t-a+i)throw Error("Jumlah pembayaran kurang dari total");return r.create(e)}async getSummary(e,t){return r.getSummary(e,t)}async getTodaySales(){return r.getTodaySales()}async getRecentSales(e){return r.getRecentSales(e)}async getDailySummary(e=new Date){let t=new Date(e);t.setHours(0,0,0,0);let a=new Date(e);return a.setHours(23,59,59,999),r.getSummary(t.toISOString(),a.toISOString())}};e.s(["saleService",0,i],38447),e.s([],95717)},9456,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(14444),o=e.i(37092),l=e.i(69741),d=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),m=e.i(66012),y=e.i(70101),g=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var w=e.i(220),v=e.i(89171);e.i(95717);var x=e.i(38447),R=e.i(57660),A=e.i(79832);async function k(e){try{if(!await (0,R.getServerSession)(A.authOptions))return v.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),a=t.get("startDate")||void 0,r=t.get("endDate")||void 0,n=await x.saleService.getSummary(a,r);return v.NextResponse.json(n)}catch(e){return console.error("Error fetching sales summary:",e),v.NextResponse.json({error:"Gagal mengambil ringkasan penjualan"},{status:500})}}e.s(["GET",()=>k],7044);var S=e.i(7044);let E=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/sales/summary/route",pathname:"/api/sales/summary",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/sales/summary/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:b,workUnitAsyncStorage:C,serverHooks:q}=E;function P(){return(0,r.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:C})}async function T(e,t,r){E.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/sales/summary/route";v=v.replace(/\/index$/,"")||"/";let x=await E.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:A,nextConfig:k,parsedUrl:S,isDraftMode:b,prerenderManifest:C,routerServerContext:q,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,resolvedPathname:_,clientReferenceManifest:N,serverActionsManifest:I}=x,M=(0,l.normalizeAppPath)(v),U=!!(C.dynamicRoutes[M]||C.routes[_]),D=async()=>((null==q?void 0:q.render404)?await q.render404(e,t,S,!1):t.end("This page could not be found"),null);if(U&&!b){let e=!!C.routes[_],t=C.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(k.experimental.adapterPath)return await D();throw new h.NoFallbackError}}let O=null;!U||E.isDev||b||(O="/index"===(O=_)?"/":O);let B=!0===E.isDev||!U,j=U&&!B;I&&N&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:N,serverActionsManifest:I,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:I})});let H=e.method||"GET",$=(0,i.getTracer)(),F=$.getActiveScopeSpan(),K={params:A,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!k.experimental.authInterrupts},cacheComponents:!!k.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:k.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>E.onRequestError(e,t,r,q)},sharedContext:{buildId:R}},L=new d.NodeNextRequest(e),G=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let s=async e=>E.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=$.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${H} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let d=async({previousCacheEntry:a})=>{try{if(!o&&P&&T&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=K.renderOpts.collectedTags;if(!U)return await (0,m.sendResponse)(L,G,i,K.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},q),t}},u=await E.handleResponse({req:e,nextConfig:k,cacheKey:O,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:T,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:o});if(!U)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,y.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&U||c.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,m.sendResponse)(L,G,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};F?await l(F):await $.withPropagatedContext(e.headers,()=>$.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})}),U)throw t;return await (0,m.sendResponse)(L,G,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>P,"routeModule",()=>E,"serverHooks",()=>q,"workAsyncStorage",()=>b,"workUnitAsyncStorage",()=>C],9456)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a129ecbf._.js.map